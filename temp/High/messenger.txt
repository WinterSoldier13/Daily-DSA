// Whatsapp

-> It should support 1 to 1 communication
-> we should be able to share Image
-> The messaging should be encrypterd
-> It should keep track of read, delivered and not delivered status of messages
-> What kind of storage do we want, should the user should be alble to get all messages from any device like Telegram or the messages should be on single device
-> It should show last seen
-> Additionaly it should support group conversation

-> very low latency
-> Should be highly consistent in the sense that the messages should get to the user in the right seq
-> High availibily is good, but we between consistenct and availibily we should go with consistency

-> Estimate storage, take avg text message to be 250 chars => 500 bytes
-> Additionaly we should also store timestamp with messages, from which user it was sent to , to which user



DESIGN:

-> Make 3 clients, the client should have a mechanism to encrypt and decrypt text messages.
-> Make 3 gateway to route requests to A SESSION (redundant) servers
-> The clients are connected to server with WebSocket connection 
-> UserA sends message to userB thourgh the server, the server receives the message and sends an acknowledgment to userA, the server stores the message in its databse and send the message to userB, userB then receives the message and then sends ack to the server, the server notifies the userA that the message has been delivered to userB. Now here the userB can send 2 ttype of ACK one is that it has received the message then the USer a will only see the double tick, or it can send an ack on opening the message then the userA sees a blue Tick
-> we will store which user is connected to which gateway, so we will store userId, connectionId in a key value fashion in Reddis. 
-> To implent lastSeen we will send an hearbeat from client to server, and it will store it to a database
-> group messaging : session serive is connected to group service server, when 1 user send a message it finds out which gateway are the users of the particular grp connected to, generally a chat application limitts the users in a greoup to 256 memebers. TO get the list of all the users in a group the service uses a database where the values are stored as Grp_ID, UserID
-> Now let's say a client was offline and now it connects to the gateway, so it will first request all the messages that it has missed from a server which will query the database and fetch the messages.


Messenger actually uses HBase
Databases:
User: userId, fName, lName, phone, email
Messages: messageID, from_userID, to_userID, isGrpMssg, grpId, timestamp, URL_of_multimedia
GrpInformation : grpID, userId




